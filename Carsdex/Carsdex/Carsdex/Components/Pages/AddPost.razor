@page "/AddPost"
@layout carsdex.Layout.AddPostLayout
@rendermode InteractiveServer

<div class="container">

    <div class="Img-Layout">
        <select @bind="SelectedLayout">
            <option value="1">Layout 1</option>
            <option value="2">Layout 2</option>
            <option value="3">Layout 3</option>
            <option value="4">Layout 4</option>
            <option value="5">Layout 5</option>
        </select>

        <div class="img-container">
            @switch (SelectedLayout)
            {
                case 1:
                    @ImageBox(1, "big-container")
                    break;

                case 2:
                    @ImageBox(2, "big-container")
                    @ImageBox(3, "big-container")
                    break;

                case 3:
                    @ImageBox(4, "big-container")
                    <div class="small-wrapper">
                        @ImageBox(5, "small-container")
                        @ImageBox(6, "small-container")
                    </div>
                    break;

                case 4:
                    @ImageBox(7, "big-container")
                    <div class="small-wrapper">
                        <div class="small-row">
                            @ImageBox(8, "small-container")
                            @ImageBox(9, "small-container")
                        </div>
                        @ImageBox(10, "bottom-container")
                    </div>
                    break;

                case 5:
                    @ImageBox(11, "big-container")
                    <div class="small-wrapper">
                        @ImageBox(12, "small-container")
                        @ImageBox(13, "small-container")
                    </div>
                    <div class="small-wrapper">
                        @ImageBox(14, "small-container")
                        @ImageBox(15, "small-container")
                    </div>
                    break;
            }
        </div>
    </div>

    <div class="data-container">

        <div class="text-style">
            <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="white"
                 class="bi bi-caret-down-fill" viewBox="0 0 16 16">
                <path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1
                             .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
            </svg>
            <input type="text" placeholder="Modelname">
        </div>

        <div class="text-style">
            <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="white"
                 class="bi bi-caret-down-fill" viewBox="0 0 16 16">
                <path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1
                             .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
            </svg>
            <input type="text" placeholder="Markenname">
        </div>

        <div class="text-style">
            <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="white"
                 class="bi bi-geo-alt-fill" viewBox="0 0 16 16">
                <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10m0-7a3 3 0 1 1
                             0-6 3 3 0 0 1 0 6" />
            </svg>
            <input type="text" placeholder="Ort">
        </div>

        <div class="text-style">
            <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="white"
                 class="bi bi-calendar" viewBox="0 0 16 16">
                <path d="M3.5 0a.5.5 0 0 0-.5.5V1H2a2 2 0 0 0-2 2v1h16V3a2 2 0 0 0-2-2h-1V.5
                             a.5.5 0 0 0-1 0V1H3.5V.5a.5.5 0 0 0-.5-.5zM0 5v9a2 2 0 0 0 2 2h12a2 2 0 0
                             0 2-2V5H0z" />
            </svg>
            <input type="text" placeholder="Datum">
        </div>

        <div class="text-style upload-style">
            <label for="file-upload">
                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="white"
                     class="bi bi-plus-circle" viewBox="0 0 16 16">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16" />
                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3
                                 h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                </svg>
                Weitere Bilder
            </label>

            <input id="file-upload" type="file" accept="image/*" multiple>
        </div>
    </div>

    <div class="Delet_Post">
        <button class="Post">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="white"
                 class="bi bi-upload" viewBox="0 0 16 16">
                <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5
                             a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5" />
                <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5
                             2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708z" />
            </svg>
        </button>

        <a href="/">
            <button class="Delete">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="white"
                     class="bi bi-trash3" viewBox="0 0 16 16">
                    <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5
                                 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H1.5a.5.5 0 0 0 0 1h.538
                                 l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66
                                 h.538a.5.5 0 0 0 0-1z" />
                    <path d="M5.471 4.5a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5
                                 5.03a.5.5 0 0 1 .47-.53" />
                    <path d="M10.529 4.5a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06
                                 l.5-8.5a.5.5 0 0 1 .528-.47" />
                    <path d="M8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5" />
                </svg>
            </button>
        </a>
    </div>
</div>

@code {
    // Aktuell ausgewähltes Layout
    int SelectedLayout = 1;

    Dictionary<int, string?> Images = new();

    // Liest ein ausgewähltes Bild ein, konvertiert es in Base64 und speichert es indexbasiert zur späteren Anzeige im UI.
    private async Task OnImageSelected(InputFileChangeEventArgs e, int index)
    {
        var file = e.File;

        using var stream = file.OpenReadStream(5000000);
        using var ms = new MemoryStream();
        await stream.CopyToAsync(ms);

        Images[index] =
            $"data:{file.ContentType};base64,{Convert.ToBase64String(ms.ToArray())}";
    }

    string? GetImage(int index)
        => Images.TryGetValue(index, out var img) ? img : null;

    // Erstellt eine wiederverwendbare ImageBox als RenderFragment
    RenderFragment ImageBox(int index, string cssClass) => __builder =>
    {
    <label class="@cssClass upload-box">
        @if (GetImage(index) == null)
        {
           <span>+</span>
        }
        else
        {
           <img src="@GetImage(index)" />
        }

        <InputFile OnChange="e => OnImageSelected(e, index)"
                   accept="image/*"
                   style="display:none" />
    </label>;
    };
}